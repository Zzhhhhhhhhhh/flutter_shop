webpackJsonp([8],{"3+v0":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Gu7T"),o=a.n(i),s=a("mvHQ"),n=a.n(s),l=a("iPNc"),r={name:"parameterSet",data:function(){return{form:{frontAllSeat:0},zhongpai:void 0,houpai:void 0,img:void 0,backLine:void 0,frontLine:void 0,positionX:0,positionY:0,host:"",timer:null,VSPlayer:null,videoTimer:null,failNum:0,ServerIp:"",port:"",stream:"",keepAliveTimer:null,listQuery:{classRoom:""},acadInfo:{StatisticType:0,Enable:0,SleepTime:120,Lin1Position:0,RoomType:"",TeaThreshold:0,StuThreshold:0,TeaFaceThreshole:0,StuFaceThreshole:0,LineLeftX:0,LineLeftY:190,LineRightX:600,LineRightY:190,Line1LeftX:0,Line1LeftY:0,Line1RightX:0,Line1RightY:0},roomTypeList:[{value:0,label:"小教室"},{value:1,label:"大教室"}],computeList:[{value:0,label:"前后排"},{value:1,label:"前中后排"}],a:"",showType:"",deviceRegisterType:"",mouseFrom:{},mouseTo:{},canvas:null,drawingObject:null,drawType:"",textbox:null,color:"red",drawWidth:2,moveCount:1,doDrawing:!1,config:{canvasState:[],currentStateIndex:-1,undoStatus:!1,undoFinishedStatus:1},isFirst:!0,rectWidth:0,rectHeight:0,totalRect:[],downX:0,downY:0,echoFlag:!1,naturalWidth:0,naturalHeight:0,points:[[],[]]}},watch:{failNum:function(e){5===e&&(this.failNum=0,this.Play())}},computed:{showTitle:function(){return"Q41"==this.showType?"区域配置":"AI5100"==this.showType?"学情配置":"前排区域配置"}},mounted:function(){this.getInitData(),this.getPic();var e=document.getElementById("c");this.naturalWidth=e.getBoundingClientRect().width,this.naturalHeight=e.getBoundingClientRect().height,this.__canvas=new fabric.Canvas("c")},methods:{changeCompute:function(e){this.getInitData("ch",e)},move:function(e){var t=this,a=(e||window.event,e.target),i=e.clientX-a.offsetLeft,o=e.clientY-a.offsetTop;document.onmousemove=function(e){var s=e.clientX-i,n=e.clientY-o,l=t.$refs.parentNode,r=l.offsetHeight,c=(l.offsetWidth,t.$refs.sonNode),h=c.offsetHeight,d=c.offsetWidth;s<0&&(s=0),n<0&&(n=0),n>r-h&&(n=r-h),s>r-d&&(s=0),t.positionX=n,t.positionY=s,a.style.left=s+"px",a.style.top=n+"px"},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null}},move1:function(e){var t=this,a=e.target,i=e.clientX-a.offsetLeft,o=e.clientY-a.offsetTop;document.onmousemove=function(e){var s=e.clientX-i,n=e.clientY-o;console.log(t.$refs.parentNode.offsetHeight);var l=t.$refs.parentNode,r=l.offsetHeight,c=(l.offsetWidth,t.$refs.sonNode1),h=c.offsetHeight,d=c.offsetWidth;s<0&&(s=0),n<0&&(n=0),n>r-h&&(n=r-h),s>r-d&&(s=0),t.positionX=n,t.positionY=s,a.style.left=s+"px",a.style.top=n+"px"},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null}},handleSave1:function(){var e=this,t=document.getElementById("blueLine"),a=document.getElementById("yellowLine"),i=t.offsetTop+document.body.scrollTop,o=a.offsetTop+document.body.scrollTop,s=!1;/[^\d]/g.test(parseInt(this.form.frontAllSeat))?(this.form.frontAllSeat=0,this.$set(this.form,"frontAllSeat",0),this.$message("前部区域座位数量不输入字符!"),s=!1):s=!0,s&&this.$http.get(this.host+"/FrontAndBackLine.do?cmd=1&backLine="+i+"&frontLine="+o+"&frontAllSeat="+this.form.frontAllSeat+"&rand="+(new Date).getTime()).then(function(t){0===parseInt(t.body)?(e.$message("配置成功!"),e.getImg()):e.$message("配置失败!")}).catch(function(e){console.log(e)})},getImg:function(){var e=this,t=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.1)"});this.$http.get(this.host+"/FrontAndBackLine.do?cmd=0&rand="+(new Date).getTime()).then(function(a){t.close();var i=document.getElementById("blueLine"),o=document.getElementById("yellowLine");e.img=e.host+"/"+a.body.path+"?rand="+(new Date).getTime(),i.style.left="0px",e.form.frontAllSeat=a.body.frontAllSeat,i.style.top=a.body.backLine/2+"px",o.style.left="0px",o.style.top=a.body.frontLine/2+"px"}).catch(function(e){console.log(e)})},getCookie:function(e){for(var t=e+"=",a=document.cookie.split(";"),i=0;i<a.length;i++){for(var o=a[i];" "===o.charAt(0);)o=o.substring(1);if(-1!==o.indexOf(t))return o.substring(t.length,o.length)}return""},preview:function(e,t){if(this.VSPlayer=document.getElementById("VSPlayer"),this.VSPlayer.width="650px",null!==t){if(t.children)return!1}else window.document.getElementById("previewMeeting").style.display="block";this.$http.post(this.host+this.httpUrl.InteractiveCloud.ConferenceUrls.Preview,{streamType:null===t?0:parseInt(e.data.deviceUUID.split("-")[0]),deviceUUID:null===t?e.deviceUUID.split("-")[0]:e.parent.data.deviceUUID}).then(function(e){var t=this;e.body.Success?200===e.body.Value.StatusCode?(this.previewUrls=e.body.Value.result.streamUrl,this.ServerIp=this.previewUrls.split(":")[0],this.port=this.previewUrls.split(":")[1].split("/")[0],this.stream=this.previewUrls.split(":")[1].split("/")[1],this.failNum=0,this.Play(),clearInterval(this.keepAliveTimer),this.keepAliveTimer=setInterval(function(){t.keepAlive(t.ServerIp+":"+t.port+"/"+t.stream)},1e4)):(this.$message.error(e.body.Value.result),this.previewUrls=""):this.$message.error(e.body.Message)}).catch(function(e){console.log(e)})},Stop:function(){this.VSPlayer.Stop()},Play:function(){var e=this;this.Stop(),this.VSPlayer.Play(this.ServerIp,parseInt(this.port),this.stream),clearInterval(this.videoTimer),this.videoTimer=setInterval(function(){0===e.VSPlayer.GetStatus()?(e.failNum++,console.log(e.VSPlayer.GetStatus())):(e.failNum=0,console.log(e.VSPlayer.GetStatus()))},200)},getInitData:function(e,t){var a=this;this.points=[],this.$https.get("/Camera_GetInit.do").then(function(i){a.showType=i.DeviceName,a.deviceRegisterType=i.CloudAIRegister[0].CameraType;var o=i.Statistic[0];a.acadInfo.Enable=o.Enable,a.acadInfo.RoomType=o.RoomType,a.acadInfo.SleepTime=o.SleepTime,a.acadInfo.TeaThreshold=o.TeaThreshold,a.acadInfo.StuThreshold=o.StuThreshold,a.acadInfo.TeaFaceThreshole=o.TeaFaceThreshole,a.acadInfo.StuFaceThreshole=o.StuFaceThreshole,a.acadInfo.StatisticType=i.Statistic[0].StatisticType;var s=[{x:o.LeftUpX,y:o.LeftUpY,color:"red"},{x:o.RightUpX,y:o.RightUpY,color:"red"},{x:o.RightDownX,y:o.RightDownY,color:"red"},{x:o.LeftDownX,y:o.LeftDownY,color:"red"}],n=[{x:o.LineLeftX,y:o.LineLeftY,color:"green"},{x:o.LineRightX,y:o.LineRightY,color:"green"}],l=[{x:o.Line1LeftX,y:o.Line1LeftY,color:"blue"},{x:o.Line1RightX,y:o.Line1RightY,color:"blue"}];s=s.map(function(e){return{x:parseInt(710*e.x/960),y:parseInt(540*e.y/540),color:e.color}}),n=n.map(function(e){return{x:parseInt(710*e.x/960),y:parseInt(540*e.y/540),color:e.color}}),l=l.map(function(e){return{x:parseInt(710*e.x/960),y:parseInt(540*e.y/540),color:e.color}}),"ch"==e?(a.acadInfo.StatisticType=t,a.points=1==t?[s,n,l]:[s,n]):1==i.Statistic[0].StatisticType?a.points=[s,n,l]:a.points=[s,n],"AI5100"!=i.DeviceName&&a.createPolygon()})},handleSave:function(){var e=this,t=JSON.parse(n()(this.points));if(t.forEach(function(t){t.forEach(function(t){t.x>710?t.x=710/e.naturalWidth*960:t.x<0?t.x=0:t.x=parseInt(t.x/e.naturalWidth*960),t.y>540?t.y=540/e.naturalHeight*540:t.y<0?t.y=0:t.y=parseInt(t.y/e.naturalHeight*540)})}),console.log(t),1==this.acadInfo.StatisticType&&(this.acadInfo.Line1LeftX=t[2][0].x,this.acadInfo.Line1LeftY=t[2][0].y,this.acadInfo.Line1RightX=t[2][1].x,this.acadInfo.Line1RightY=t[2][1].y),this.acadInfo.LineLeftX=t[1][0].x,this.acadInfo.LineLeftY=t[1][0].y,this.acadInfo.LineRightX=t[1][1].x,this.acadInfo.LineRightY=t[1][1].y,this.acadInfo.LeftUpX=t[0][0].x,this.acadInfo.LeftUpY=t[0][0].y,this.acadInfo.RightUpX=t[0][1].x,this.acadInfo.RightUpY=t[0][1].y,this.acadInfo.RightDownX=t[0][2].x,this.acadInfo.RightDownY=t[0][2].y,this.acadInfo.LeftDownX=t[0][3].x,this.acadInfo.LeftDownY=t[0][3].y,"AT2023"!=this.showType?0==this.deviceRegisterType?(this.acadInfo.TeaThreshold=this.acadInfo.TeaThreshold,this.acadInfo.TeaFaceThreshole=this.acadInfo.TeaFaceThreshole,this.acadInfo.StuThreshold=this.acadInfo.TeaThreshold,this.acadInfo.StuFaceThreshole=this.acadInfo.TeaFaceThreshole):(this.acadInfo.StuThreshold=this.acadInfo.TeaThreshold,this.acadInfo.StuFaceThreshole=this.acadInfo.TeaFaceThreshole):(this.acadInfo.TeaThreshold=this.acadInfo.TeaThreshold,this.acadInfo.StuThreshold=this.acadInfo.StuThreshold),this.acadInfo.SleepTime<1||this.acadInfo.SleepTime>120)this.$message.error("时间间隔为1-120秒");else{if(!Object(l.c)(this.acadInfo.SleepTime,5,120))return this.$message.error("时间间隔为5-120秒"),!1;if(!Object(l.c)(this.acadInfo.TeaThreshold,0,100))return this.$message.error("人头阈值为0-100"),!1;if(!Object(l.c)(this.acadInfo.StuThreshold,0,100))return this.$message.error("人头阈值为0-100"),!1;if(console.log(this.acadInfo.TeaFaceThreshole),console.log(this.acadInfo.StuFaceThreshole),"AI5100"!=this.showType){if(!Object(l.c)(this.acadInfo.TeaFaceThreshole,0,100))return this.$message.error("人脸阈值为0-100"),!1;if(!Object(l.c)(this.acadInfo.StuFaceThreshole,0,100))return this.$message.error("人脸阈值为0-100"),!1}this.$https.get("/Camera_SetStatisticInfo.do",this.acadInfo).then(function(t){1==t?e.$message.success("配置成功!"):e.$message.error("配置失败!")})}},getPic:function(){var e=this;this.$https.get("/Camera_Snap.do",{SnapType:1}).then(function(t){1==t&&(e.img="/upload/Statistic.jpg?hber ="+(new Date).getTime())})},createPolygon:function(){var e,t=this,a=this.__canvas;a?a.clear():(a=new fabric.Canvas("c"),this.__canvas=a);var i=document.getElementById("c");a.setWidth(i.clientWidth),a.setHeight(i.clientHeight),a.off("object:moving");var s=this.points.map(function(e){return new fabric.Polygon(e,{fill:"transparent",stroke:e[0].color,strokeWidth:2,objectCaching:!1,selectable:!1,evented:!1,opacity:.5})}),n=[];this.points.forEach(function(e,t){e.forEach(function(e,a){var i="";if(0==t)switch(a){case 0:i="red";break;case 1:i="yellow";break;case 2:i="blue";break;case 3:i="orange"}else i=0==a?"green":"purple";n.push(new fabric.Circle({left:e.x,top:e.y,parentIndex:t,childrenIndex:a,radius:8,fill:i,stroke:"#000",strokeWidth:2,originX:"center",originY:"center",hasControls:!1,hasBorders:!1,selectable:!0,evented:!0,cid:"circle-"+t+"-"+a}))})}),(e=a).add.apply(e,o()(s).concat(n)),a.on("object:moving",function(e){var i=e.target;if(void 0!==i.parentIndex&&void 0!==i.childrenIndex){var o=i.parentIndex,s=i.childrenIndex;i.left<0&&(i.left=0),i.top<0&&(i.top=0),i.left>a.width&&(i.left=a.width),i.top>a.height&&(i.top=a.height),t.points[o][s].x=i.left,t.points[o][s].y=i.top;var n=a.item(o);if(n&&n instanceof fabric.Polygon){var l=n.get("points");l[s].x=i.left,l[s].y=i.top,n.set("dirty",!0)}a.renderAll()}}),a.renderAll()}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"middle",staticStyle:{width:"100%"}},[a("div",{directives:[{name:"wechat-title",rawName:"v-wechat-title",value:e.$route.meta.title,expression:"$route.meta.title"}]}),e._v(" "),a("div",[a("div",{staticClass:"module",staticStyle:{"padding-bottom":"20px"}},[a("h4",[a("span"),e._v(e._s(e.showTitle))]),e._v(" "),a("div",{staticClass:"xueqingModule"},[a("div",{staticClass:"zhezhao"},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{src:e.img,alt:""}}),e._v(" "),a("div",{ref:"parentNode",staticClass:"zhezhao1"},[a("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"sonNode",staticStyle:{width:"100%",background:"blue",height:"3px"},attrs:{id:"blueLine"},on:{mousedown:e.move}}),e._v(" "),e._m(0)])]),e._v(" "),a("div",{staticClass:"anniu"},[a("div",{staticStyle:{"padding-top":"10px",width:"100%",height:"50px","font-size":"13px","line-height":"20px","margin-bottom":"30px",color:"red"}}),e._v(" "),a("el-form",{ref:"form",attrs:{"label-width":"70px"}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"教室类型"}},[a("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:e.acadInfo.RoomType,callback:function(t){e.$set(e.acadInfo,"RoomType",t)},expression:"acadInfo.RoomType"}},e._l(e.roomTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"AI5100"!=e.showType,expression:"showType != 'AI5100'"}],staticStyle:{"font-size":"14px",color:"green"}},[a("i",{staticClass:"el-icon-info"}),e._v("\n              "+e._s(0==e.acadInfo.StatisticType?"绿色线段为前后排分割线":"绿色线段为前中排分割线")+"\n            ")]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"AI5100"!=e.showType,expression:"showType != 'AI5100'"}],staticStyle:{"font-size":"14px","margin-bottom":"20px"}},[a("span",{staticStyle:{color:"green","margin-left":"20px"}},[e._v("前后分割线:")]),e._v(" "),a("div",{staticClass:"riceInfo"},[a("div",[a("span",[a("i",{staticClass:"green"}),e._v("\n                    ：左\n                  ")]),e._v(" "),a("span",[a("i",{staticClass:"purple"}),e._v("\n                    ：右\n                  ")])])])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.acadInfo.StatisticType,expression:"acadInfo.StatisticType == 1"}],staticStyle:{"font-size":"14px",color:"blue"}},[a("i",{staticClass:"el-icon-info"}),e._v(" 蓝色线段为中后排分割线\n            ")]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"AI5100"!=e.showType,expression:"showType != 'AI5100'"}],staticStyle:{"font-size":"14px",color:"red"}},[a("i",{staticClass:"el-icon-info"}),e._v(" 红色矩形内为有效识别区\n            ")]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"AI5100"!=e.showType,expression:"showType != 'AI5100'"}],staticStyle:{"font-size":"14px","margin-bottom":"20px"}},[a("span",{staticStyle:{color:"red","margin-left":"20px"}},[e._v("有效识别区:")]),e._v(" "),a("div",{staticClass:"riceInfo"},[a("div",[a("span",[a("i",{staticClass:"red"}),e._v("\n                    ：左上角\n                  ")]),e._v(" "),a("span",[a("i",{staticClass:"yellow"}),e._v("\n                    ：右上角\n                  ")])]),e._v(" "),a("div",[a("span",[a("i",{staticClass:"orange"}),e._v("\n                    ：左下角\n                  ")]),e._v(" "),a("span",[a("i",{staticClass:"blue"}),e._v("\n                    ：右下角\n                  ")])])])]),e._v(" "),a("el-form-item",{attrs:{label:"是否启用"}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.acadInfo.Enable,callback:function(t){e.$set(e.acadInfo,"Enable",t)},expression:"acadInfo.Enable"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"AI5100"!=e.showType,expression:"showType != 'AI5100'"}],attrs:{label:"计算方式"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{size:"small",placeholder:"请选择"},on:{change:function(t){return e.changeCompute(e.acadInfo.StatisticType)}},model:{value:e.acadInfo.StatisticType,callback:function(t){e.$set(e.acadInfo,"StatisticType",t)},expression:"acadInfo.StatisticType"}},e._l(e.computeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"AI5100"!=e.showType,expression:"showType != 'AI5100'"}],attrs:{"label-width":"",label:"间隔时间"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{size:"small",type:"number",min:1,max:120},model:{value:e.acadInfo.SleepTime,callback:function(t){e.$set(e.acadInfo,"SleepTime",t)},expression:"acadInfo.SleepTime"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("5s-120s")])],1),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:"AT2023"==e.showType,expression:"showType == 'AT2023'"}]},[e._v("老师：")]),e._v(" "),a("el-form-item",{attrs:{label:"人头阈值"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{size:"small",type:"number",min:1,max:120},model:{value:e.acadInfo.TeaThreshold,callback:function(t){e.$set(e.acadInfo,"TeaThreshold",t)},expression:"acadInfo.TeaThreshold"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("0 - 100")])],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"AI5100"!=e.showType,expression:"showType != 'AI5100'"}],attrs:{label:"人脸阈值"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{size:"small",type:"number",min:1,max:120},model:{value:e.acadInfo.TeaFaceThreshole,callback:function(t){e.$set(e.acadInfo,"TeaFaceThreshole",t)},expression:"acadInfo.TeaFaceThreshole"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("0 - 100")])],1),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:"AT2023"==e.showType,expression:"showType == 'AT2023'"}]},[e._v("学生：")]),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"AT2023"==e.showType,expression:"showType == 'AT2023'"}],attrs:{label:"人头阈值"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{size:"small",type:"number",min:1,max:120},model:{value:e.acadInfo.StuThreshold,callback:function(t){e.$set(e.acadInfo,"StuThreshold",t)},expression:"acadInfo.StuThreshold"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("0-100")])],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"AT2023"==e.showType,expression:"showType == 'AT2023'"}],attrs:{label:"人脸阈值"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{size:"small",type:"number",min:1,max:120},model:{value:e.acadInfo.StuFaceThreshole,callback:function(t){e.$set(e.acadInfo,"StuFaceThreshole",t)},expression:"acadInfo.StuFaceThreshole"}}),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("0-100")])],1)],1),e._v(" "),a("el-button",{staticStyle:{margin:"10px auto",display:"block"},attrs:{type:"primary",size:"mini"},on:{click:e.handleSave}},[e._v("设置")])],1)])])])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"canvas_container"},[t("canvas",{attrs:{id:"c",width:"710",height:"540"}})])}]};var h=a("VU/8")(r,c,!1,function(e){a("duo7"),a("nKIJ")},"data-v-ec9f1a7e",null);t.default=h.exports},duo7:function(e,t){},nKIJ:function(e,t){}});